{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "AI Training Metadata Schema",
  "description": "Standardized metadata for AI learning from documents",
  
  "definitions": {
    "entity_annotation": {
      "type": "object",
      "properties": {
        "text": {"type": "string"},
        "start": {"type": "integer"}, 
        "end": {"type": "integer"},
        "entity_type": {
          "type": "string",
          "enum": ["ORGANIZATION", "PERSON", "LOCATION", "DATE", "TIME", "POWER_VALUE", "EQUIPMENT", "MONEY"]
        },
        "confidence": {"type": "number", "minimum": 0, "maximum": 1},
        "context": {"type": "string"}
      },
      "required": ["text", "start", "end", "entity_type"]
    },
    
    "relationship_annotation": {
      "type": "object", 
      "properties": {
        "subject": {"type": "string"},
        "predicate": {
          "type": "string",
          "enum": ["OWNS", "OPERATES", "REPORTS_TO", "CAUSES", "AFFECTS", "LOCATED_IN"]
        },
        "object": {"type": "string"},
        "confidence": {"type": "number", "minimum": 0, "maximum": 1},
        "context": {"type": "string"}
      },
      "required": ["subject", "predicate", "object"]
    },
    
    "document_structure": {
      "type": "object",
      "properties": {
        "title": {"type": "string"},
        "sections": {
          "type": "array",
          "items": {
            "type": "object",
            "properties": {
              "id": {"type": "string"},
              "title": {"type": "string"},
              "type": {
                "type": "string", 
                "enum": ["header", "content", "table", "list", "annex", "summary"]
              },
              "page": {"type": "integer"},
              "content": {"type": "string"},
              "subsections": {"type": "array", "items": {"$ref": "#/definitions/document_structure/properties/sections/items"}}
            },
            "required": ["id", "type", "content"]
          }
        }
      }
    }
  },
  
  "type": "object",
  "properties": {
    "document_id": {
      "type": "string",
      "description": "Unique identifier for the document"
    },
    
    "document_metadata": {
      "type": "object",
      "properties": {
        "filename": {"type": "string"},
        "file_size": {"type": "integer"},
        "page_count": {"type": "integer"},
        "language": {"type": "string", "default": "es"},
        "creation_date": {"type": "string", "format": "date-time"},
        "processing_date": {"type": "string", "format": "date-time"},
        "document_type": {
          "type": "string",
          "enum": ["power_system_failure", "maintenance_report", "compliance_document", "technical_manual", "other"]
        },
        "domain": {
          "type": "string", 
          "enum": ["power_systems", "finance", "legal", "maintenance", "other"]
        }
      },
      "required": ["filename", "document_type", "domain"]
    },
    
    "structure": {
      "$ref": "#/definitions/document_structure"
    },
    
    "ai_annotations": {
      "type": "object",
      "properties": {
        "entities": {
          "type": "array",
          "items": {"$ref": "#/definitions/entity_annotation"}
        },
        
        "relationships": {
          "type": "array", 
          "items": {"$ref": "#/definitions/relationship_annotation"}
        },
        
        "classifications": {
          "type": "object",
          "properties": {
            "primary_classification": {
              "type": "string",
              "enum": ["critical", "high", "medium", "low", "informational"]
            },
            "secondary_classifications": {
              "type": "array",
              "items": {"type": "string"}
            },
            "confidence_scores": {
              "type": "object",
              "additionalProperties": {"type": "number", "minimum": 0, "maximum": 1}
            }
          }
        },
        
        "key_insights": {
          "type": "array",
          "items": {
            "type": "object",
            "properties": {
              "insight": {"type": "string"},
              "importance": {"type": "number", "minimum": 0, "maximum": 1},
              "supporting_text": {"type": "string"},
              "insight_type": {
                "type": "string",
                "enum": ["root_cause", "impact_assessment", "recommendation", "trend", "anomaly"]
              }
            },
            "required": ["insight", "insight_type"]
          }
        }
      }
    },
    
    "training_labels": {
      "type": "object",
      "description": "Ground truth labels for supervised learning",
      "properties": {
        "classification_labels": {
          "type": "object",
          "additionalProperties": {"type": "string"}
        },
        
        "entity_labels": {
          "type": "array",
          "items": {"$ref": "#/definitions/entity_annotation"}
        },
        
        "relationship_labels": {
          "type": "array",
          "items": {"$ref": "#/definitions/relationship_annotation"}
        },
        
        "summary_labels": {
          "type": "object",
          "properties": {
            "extractive_summary": {"type": "string"},
            "abstractive_summary": {"type": "string"},
            "key_points": {
              "type": "array", 
              "items": {"type": "string"}
            }
          }
        },
        
        "quality_scores": {
          "type": "object",
          "properties": {
            "readability": {"type": "number", "minimum": 0, "maximum": 1},
            "completeness": {"type": "number", "minimum": 0, "maximum": 1},
            "accuracy": {"type": "number", "minimum": 0, "maximum": 1},
            "relevance": {"type": "number", "minimum": 0, "maximum": 1}
          }
        }
      }
    },
    
    "embeddings": {
      "type": "object",
      "properties": {
        "document_embedding": {
          "type": "array",
          "items": {"type": "number"},
          "description": "Whole document vector representation"
        },
        
        "chunk_embeddings": {
          "type": "array",
          "items": {
            "type": "object",
            "properties": {
              "chunk_id": {"type": "string"},
              "text": {"type": "string"},
              "embedding": {
                "type": "array",
                "items": {"type": "number"}
              },
              "chunk_type": {"type": "string"},
              "semantic_tags": {
                "type": "array",
                "items": {"type": "string"}
              }
            },
            "required": ["chunk_id", "text", "embedding"]
          }
        },
        
        "embedding_model": {
          "type": "string",
          "description": "Model used to generate embeddings"
        },
        
        "embedding_dimension": {
          "type": "integer",
          "description": "Dimension of embedding vectors"
        }
      }
    },
    
    "processing_metadata": {
      "type": "object",
      "properties": {
        "processing_pipeline_version": {"type": "string"},
        "extraction_confidence": {"type": "number", "minimum": 0, "maximum": 1},
        "processing_time_seconds": {"type": "number"},
        "errors_encountered": {
          "type": "array",
          "items": {
            "type": "object", 
            "properties": {
              "error_type": {"type": "string"},
              "error_message": {"type": "string"},
              "severity": {
                "type": "string",
                "enum": ["low", "medium", "high", "critical"]
              }
            }
          }
        },
        "quality_checks": {
          "type": "object",
          "properties": {
            "text_extraction_quality": {"type": "number", "minimum": 0, "maximum": 1},
            "structure_detection_confidence": {"type": "number", "minimum": 0, "maximum": 1},
            "entity_extraction_coverage": {"type": "number", "minimum": 0, "maximum": 1}
          }
        }
      }
    }
  },
  
  "required": ["document_id", "document_metadata", "structure", "processing_metadata"]
}